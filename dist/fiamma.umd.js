var e,t;e=this,t=function(e){'use strict';const t=e=>e.host===location.host&&e.pathname!==location.pathname,o=e=>Array.from(e||document.querySelectorAll('a')).filter(t),n=(e,t,o)=>t.forEach((t=>e.addEventListener(t,o,{passive:!0}))),s={},c=e=>{const t=new IntersectionObserver((e=>{for(const o of e)if(o.isIntersecting){const{href:e,pathname:n}=o.target;s[n]||(s[n]=!0,fetch(e)),t.unobserve(o.target)}}));o(e).forEach((e=>t.observe(e)))},r=e=>{let t=!1;const c=new XMLHttpRequest;for(const r of o(e))n(r,['mouseenter','touchstart'],(()=>{const{href:e,pathname:o}=r;s[o]||(c.onload=c.onerror=()=>s[o]=!0,c.open('get',e),c.send(),t=!0)})),n(r,['mouseleave'],(()=>{t&&(t=!1,c.abort())}))},i='fiamma',a=`${i}:end`,l=history,u=window,d=(e,t=document)=>t.querySelectorAll(e),f=(e,t,o)=>e.addEventListener(t,o),p=(e,t)=>dispatchEvent(new CustomEvent(i+':'+e,t&&{detail:t})),m=e=>Array.from(e),h=e=>{const t=new URL(e||location.href).href;return'/'===t.slice(-1)||t.includes('.')?t:t+'/'},v=e=>{const t=(e||location).hash;t?document.getElementById(t.slice(1))?.scrollIntoView(e&&{behavior:'smooth'}):window.scrollTo({top:0})};let w;const $=(e,t)=>e?.replaceWith(t),g=(e,t=0)=>{if(e.length===t)return;const o=e[t];if(o.hasAttribute(i+'-ignore'))return g(e,++t);const n=document.createElement('script'),s=m(o.attributes);for(const{name:e,value:t}of s)n.setAttribute(e,t);n.textContent=o.textContent,n.src?(n.onload=n.onerror=()=>g(e,++t),$(o,n)):($(o,n),g(e,++t))};let y=!1;const b=new XMLHttpRequest,T=async e=>{let t=e?.t,o=e?.o;t&&o&&(p('fetch'),y&&b.abort(),b.onload=()=>{y=!1;const e=b.status;if(e>200||e<200)return void(location.href=o);'pop'!==t&&(e=>{l.state?.url!==e&&l.pushState({url:e},'internalLink',e)})(o);const n=(s=b.responseText,(new DOMParser).parseFromString(s,'text/html'));var s;(e=>{const t=e=>m(d(`:not([${i}-persist]`,e.head)),o=((e,t)=>{const o=[],n=[];let s=0,c=0;for(;s<e.length||c<t.length;){const r=e[s],i=t[c];if(r?.isEqualNode(i)){s++,c++;continue}const a=r?n.findIndex((e=>e.isEqualNode(r))):-1;if(-1!==a){n.splice(a,1),s++;continue}const l=i?o.findIndex((e=>e.isEqualNode(i))):-1;-1===l?(r&&o.push(r),i&&n.push(i),s++,c++):(o.splice(l,1),c++)}return{i:o,l:n}})(t(document),t(e));o.i.forEach((e=>e.remove())),document.head.append(...o.l)})(n),(e=>{const t=document.body;d(`[${i}-preserve][id]`,t).forEach((t=>$(e.getElementById(t.id),t))),w&&e.body.append(w),$(t,e.body)})(n),g(d(`script[${i}-reload]`,document.head)),g(d(`script:not([${i}-ignore])`,document.body)),v(),p('end')},b.onprogress=e=>p('progress',e),b.open('GET',o),b.send(),y=!0)},_=e=>T((e=>{const t=(e=>{let t=e;for(let o=e;o.parentNode;o=o.parentNode)if('A'===o.nodeName){t=o;break}return t})(e.target);if((e=>e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)(e)||(e=>'A'!==e.nodeName||e.host!==location.host||'_blank'===e.target||e.hasAttribute(i+'-off'))(t))return;e.preventDefault();const{href:o,hash:n,pathname:s}=t;return n&&location.pathname===s?(c=o,l.state?.url!==c&&l.replaceState({url:c},'internalLink',c),void v(t)):location.href!==o?{t:'link',o:h(o)}:void 0;var c})(e)),k=()=>T({t:'pop',o:h()});e.EnablePrefetchHover=(e,t=!1)=>{f(u,a,(()=>{if(r(e&&d(e)),t)for(const e in s)delete s[e]})),r(e&&d(e))},e.EnablePrefetchVisible=e=>{f(u,a,(()=>{c(e&&d(e))})),c(e&&d(e))},e.EnableProgressBar=(e=500)=>{w=document.createElement('div'),w.id=`${i}-progress`,document.body.appendChild(w);const t=w.style;let o;f(u,`${i}:progress`,(({detail:e})=>{const{loaded:o,total:n}=e,s=(o/n*100).toFixed(2);s>10&&(t.transform=`scaleX(${s}%)`)})),f(u,`${i}:fetch`,(()=>{t.transition='none',t.transform='scaleX(0)',clearTimeout(o),o=setTimeout((()=>{t.opacity='1',setTimeout((()=>{t.transition='',t.transform='scaleX(10%)'}),1)}),e>0?e:1)})),f(u,`${i}:end`,(()=>{clearTimeout(o),t.transform='scaleX(100%)',t.opacity='0'}))},e.Router=()=>{f(document,'click',_),f(window,'popstate',k),v()}},'object'==typeof exports&&'undefined'!=typeof module?t(exports):'function'==typeof define&&define.amd?define(['exports'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).Fiamma={});
